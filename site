#!/bin/bash

set -e

if [ ! -f 'site.conf' ]; then
	echo "ERROR can't find site.conf, copy site.conf.example to site.conf and edit"
	exit 1
fi

source site.conf

site-usage(){
    cat <<EOM
Usage: site <command>
Commands:
  devel		   builds the site and runs a server for live development
  newpost [name]   creates a new post as content/post/YYYY-MM-DD-name.markdown
  prod		   builds and deploys the site to the prod directory
  test		   builds and deploys the site to the test directory
For more help, check the docs: https://github.com/philcryer/fak3r.com
EOM
}

site-devel(){
	hugo server
}

site-newpost(){
	echo "upcoming functionality"
	exit 0
}

site-test(){ 
	if [ ! -d '$test_dir' ]; then
		mkdir -p $test_dir
	fi
	rm -rf $test_dir/*
	hugo -b $test_url -d $test_dir
}

site-prod(){ 
	rm -rf $prod_dir/*
	hugo -d $prod_dir
}

case $1 in
    devel)
	site-devel
        ;;

    newpost)
	site-newpost
        ;;

    prod)
	site-prod
        ;;

    test)
	site-test
        ;;

    *)
	site-usage
        exit 1
        ;;

esac

exit 0
